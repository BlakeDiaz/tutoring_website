DROP TABLE IF EXISTS Bookings;
DROP TABLE IF EXISTS AppointmentTimeSlots;
DROP TABLE IF EXISTS UserRoles;
DROP TABLE IF EXISTS Users;

CREATE TABLE Users (
    userID SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(254) NOT NULL,
    passwordSaltedHashed BYTEA NOT NULL
);

CREATE TABLE UserRoles (
    userID INT REFERENCES Users,
    userRole VARCHAR(32) NOT NULL
);

CREATE TABLE AppointmentTimeSlots (
    appointmentID SERIAL PRIMARY KEY,
    date DATE NOT NULL,
    hour24 INT NOT NULL,
    capacity INT NOT NULL,
    leaderUserID INT REFERENCES Users,
    confirmationCode CHAR(6),
    subject VARCHAR(512),
    location VARCHAR(512)
);

CREATE TABLE Bookings (
    appointmentID INT REFERENCES AppointmentTimeSlots,
    userID INT REFERENCES Users,
    bookingTimestamp TIMESTAMP NOT NULL,
    comments VARCHAR(512) NOT NULL
);

INSERT INTO Users
(name, email, passwordSaltedHashed)
VALUES
('Alice Smith', 'alice@gmail.com', '\x243262243132244c314c736a4c4b4543487233702e6839633936764b4f2e6b4c496d726933445875506846304a52436259726b6a34376e476852614b'),
('Bob Smith', 'bob@gmail.com', '\x243262243132244a74512f384e334a39775a51662e3054395441734f4f666970634f3945377037504a387753424841476d527631516c4f48456b6775'),
('Charlie Smith', 'charlie@yahoo.com', '\x243262243132245a7657314b3033373857476a4649512f6833686f4d2e4561353146504e6156504c465461773043797370766e7932554e76644c6453'),
('Daniel Smith', 'daniel@gmail.com', '\x24326224313224306c454c376c3771535052394b44474d3056574f4565652e354b48434c2f3065537172464267772e714b2e646d7a474b4850753169'),
('Emma Smith', 'emma@gmail.com', '\x243262243132244c576473714966634464484f576f72497a34726b672e624e69395a3458476c6f4a466674384b756458426d6b59585a6a4d2e644853'),
('Tester', 'tester@gmail.com', '\x243262243132247045376735684f7647443862696a382e63714d7a694f456839454f6b30653161336a38624c7a666173437a662f516174586b367436'),
('Test Admin', 'testadmin@gmail.com', '\x2432622431322461543869595153677647683341734242687134387265343873724d794f78495937304b77454b6a77584d755a58425264307632772e');

INSERT INTO UserRoles
(userID, userRole)
VALUES
(7, 'admin');

INSERT INTO AppointmentTimeSlots
(date, hour24, capacity, leaderUserID, confirmationCode, subject, location)
VALUES
('2025-08-01', 9, 3, NULL, NULL, NULL, NULL),
('2025-08-01', 14, 3, 3, 841128, 'Science', 'Building A'),
('2025-08-01', 16, 2, NULL, NULL, NULL, NULL),
('2025-08-02', 9, 3, NULL, NULL, NULL, NULL),
('2025-08-02', 10, 4, NULL, NULL, NULL, NULL),
('2025-08-03', 7, 2, 1, 387122, 'Math', 'Building B'),
('2025-08-04', 11, 8, NULL, NULL, NULL, NULL),
('2025-08-05', 12, 1, NULL, NULL, NULL, NULL),
('2025-08-05', 13, 2, NULL, NULL, NULL, NULL),
('2025-08-06', 8, 4, NULL, NULL, NULL, NULL);

INSERT INTO Bookings
(appointmentID, userID, bookingTimestamp, comments)
VALUES
(6, 1, CURRENT_TIMESTAMP - INTERVAL '1' HOUR, 'No comment'),
(6, 2, CURRENT_TIMESTAMP, 'Cover matrix multiplication'),
(2, 3, CURRENT_TIMESTAMP, 'No notes');